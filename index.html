<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>GifTastic</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<style>
*{
    box-sizing:border-box;
    font-family:Arial, 'Helvetica Neue', Helvetica, sans-serif;
    line-height:150%;
}
body {
    margin:0 auto;
    padding:0;
    background:url("../images/background.jpg") no-repeat;
    background-size:cover;
}
.container{
    width:70%;
    float:left;
    text-align:center;
}
.favorite{
    width:70%;
    float:left;
    text-align:center;
    display:flex;
    flex-wrap: wrap;
    justify-content: space-around;
}
.input {
    width:30%;
    float:right;
}
.content {
    display:flex;
    flex-wrap: wrap;
    justify-content: space-around;
}
.each{
    flex:1;
    overflow:hidden;
    min-width:300px;
    height: 350px;
    /* background: red; */
    margin: 5px;
}
img{
    height:70%;
    margin:5px auto;
}
h2{
    font-size:20px;
    margin:5px;
}
h3{
    font-size:18px;
    margin:5px;
}
.add{
    width:20%;
    height:10%;
}
</style>
<script>
$(document).ready(function() {
    var topics=["dog", "cat", "rabbit", "hamster", "skunk", "goldfish", "bird", "ferret", "turtle", "sugar glider", "chinchilla", "hedgehog", "hermit crab", "gerbil", "pygmy goat", "chicken", "capybara", "teacup pig", "serval", "salamander", "frog"];
    var favor=[];
    var apikey="sDqWP1aiJ6v3Zdm916R5NtKSHIMNAK7H";
    var num=10;
    var topic;

    function setCookie(cname, cvalue, exdays) {
	  var d = new Date();
	  d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
	  var expires = "expires="+d.toUTCString();
	  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}
	
	function getCookie(cname) {
	  var name = cname + "=";
	  var ca = document.cookie.split(';');
	  for(var i = 0; i < ca.length; i++) {
	    var c = ca[i];
	    while (c.charAt(0) == ' ') {
	      c = c.substring(1);
	    }
	    if (c.indexOf(name) == 0) {
	      return c.substring(name.length, c.length);
	    }
	  }
	  return "";
	}
	
	function checkCookie() { 
	  var cookie = getCookie("favorite");
	  if (cookie != "") {
          favor=JSON.parse(getCookie("favorite"));
	    return true;
	  } else {
	    return false;
	  }
	}

    function showButton() {
        $("#buttons").empty();
        for (var i=0;i<topics.length;i++) {
            $("#buttons").append("<button data-topic='"+topics[i]+"'>"+topics[i]+"</button>");
        }
    }

    function showInput() {
        $(".input").empty();
        var form=$("<form>");
        form.append("<h2>Add an animal</h2>");
        form.append("<input type='text'><br>");
        form.append("<input id='submit' type='submit' value='Submit'>");
        $(".input").append(form);
    }

    function myFavorite() {
        $(".input").append("<br><br><br>")
        $(".input").append("<a id='favlink' href='#'><h2>My Favorite</h2></a>");
    }

    $(document).on("click","button",function(){

        if($(this).hasClass("fav") || $(this).hasClass("download") || $(this).hasClass("del")) {
            if($(this).hasClass("fav")){
                var obj={
                    "still":$(this).siblings("img").attr("data-still"), 
                    "gif":$(this).siblings("img").attr("data-gif"), 
                    "rate":$(this).siblings("img").attr("data-rate"), 
                    "title":$(this).siblings("img").attr("data-title")
                }
                favor.push(obj); 
                setCookie("favorite",JSON.stringify(favor),1);
            } else if($(this).hasClass("del")) {
                favor.splice((this).attr("data-del"),1);
                $(this).parent().remove();
                console.log($(this).parent());
                setCookie("favorite",JSON.stringify(favor),1);
            }
        } else {
            $(".favorite").hide();
            $(".container").show();
            if($(this).attr("data-num")!=undefined) {
                num=parseInt($(this).attr("data-num"))+10;
            } else {
                num=10;
            }  
            topic=$(this).attr("data-topic");  

            var queryURL="https://api.giphy.com/v1/gifs/search?api_key="+ apikey +"&q="+topic+"&limit="+num;
            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(function(response) {
                // console.log(response);
                $(".container").empty();
                var col=$("<div>");
                col.addClass("content");
                for(var i=0; i<response.data.length;i++) {
                    var rating=response.data[i].rating;
                    var title=response.data[i].title;
                    title=title.substr(0,title.length-4);
                    var stillImage=response.data[i].images["480w_still"].url;
                    var movingImage=response.data[i].images["downsized"].url;
                    var col2=$("<div>");
                    col2.addClass("each");
                    col2.append("<h2>Raiting: "+rating+"</h2>");
                    col2.append("<img src='"+stillImage+"' data-still='"+stillImage+"' data-gif='"+movingImage+"' data-status='still' data-rate='"+rating+"' data-title='"+title+"'>");
                    col2.append("<h3>Title: "+title+"</h3>");
                    col2.append("<a href='data:image/gif;"+movingImage+"' download='"+title+".gif'><button class='download'>Download</button></a>");
                    col2.append("<button class='fav'>Favorite</button>");
                    col.append(col2);
                }
                $(".container").append(col);
                $(".container").append("<button class='add' data-num='"+num+"' data-topic='"+topic+"'>Show More</button>");
            });
        }
    });

    $(document).on("click","img",function(){
        if($(this).attr("data-status")=="still") {
            $(this).attr("data-status","animated");
            $(this).attr("src",$(this).attr("data-gif"));
        } else {
            $(this).attr("data-status","still");
            $(this).attr("src",$(this).attr("data-still"));
        }
    });

    $(document).on("click","#submit",function(e){
        e.preventDefault();
        topics.push($("input").val().trim());
        showButton();
        $("#buttons button:last-child").trigger("click");
    });

    $(document).on("click","#favlink",function(e){
        $(".favorite").empty();
        $(".favorite").show();
        $(".container").hide();
        if(checkCookie()) {
            for(var i=0;i<favor.length;i++) {
                var rating=favor[i].rate;
                var title=favor[i].title;
                var stillImage=favor[i].still;
                var movingImage=favor[i].gif;
                var col2=$("<div>");
                col2.addClass("each");
                col2.append("<h2>Raiting: "+rating+"</h2>");
                col2.append("<img src='"+stillImage+"' data-still='"+stillImage+"' data-gif='"+movingImage+"' data-status='still' data-rate:'"+rating+"' data-title='"+title+"'>");
                col2.append("<h3>Title: "+title+"</h3>");
                col2.append("<button class='del' data-del='"+i+"'>delete</button>");
                $(".favorite").append(col2);
            }
        }
    });

    showButton();
    showInput();
    myFavorite();
    checkCookie();
});
</script>
<body>
<div id="buttons"></div>

<div class="input"></div>
<div class="container"></div>
<div class="favorite"></div>
<!-- <a href="http://www.kgirls.net/files/attach/images/43225/191/044/200e9bb93c5ba4e8c2bafd85cfc4a005.gif" download="w3logo">a</a> -->
<!-- https://stackoverflow.com/questions/11344531/pure-javascript-store-object-in-cookie -->


    
</body>
</html>